'use strict'

const mqtt = require('mqtt');

const hermes = {
    'hermes/hotword/default/detected': 'hotword',
    'hermes/dialogueManager/sessionEnded': 'sessionEnd',
    'hermes/intent/davidsnips:WeatherForecast': 'WeatherForecast',
    'hermes/intent/davidsnips:WeatherConditionRequest': 'WeatherConditionRequest',
    'hermes/intent/davidsnips:TemperatureForecast': 'TemperatureForecast',
}


const client  = mqtt.connect('mqtt://localhost', { port: 1883 });

client.on('connect', () => {
    for (topic in hermes) {
        client.subscribe(topic, (err) => console.log);
    }
});

client.on('message', (topic, data) => {
    let sessionId,
        slots;


    message = hermes[topic];
    if (!message)
        console.log('unknown message');
    else if (message == 'hotword') {
        console.log('hotword detected');
        console.log(data);
    } else if (message == 'sessionEnd') {
        console.log('session ended');
        console.log(data);
    } else {
        console.log(`recognized ${message}`);
        message = JSON.parse(data);
    }    
});